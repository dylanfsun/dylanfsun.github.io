---
title: "R Notebook"
output: 
  html_notebook:
    toc: true
    toc_float: true
    theme: flatly
    highlight: textmate
    include:
      after_body: footer.html
---

# Section 1
This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
plot(cars)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file).

# notes on differences
It seems like the main difference between the notebook and markdown is that the notebook continuously generates .html updates after saving that can be viewed at any time, whereas the markdown must be compiled at the end with knit. Another difference maybe is that all plots and stuff will be automatically generated when you compile the markdown, whereas in the notebok you have to produce the plot inside the actual notebook for it to show up. There's probably an option to change this. It seems to display only the most recent chunk output


# Browser history graph
## Load browsing history data

```{r}
library(jsonlite)
library(data.table)
bhistory <- fromJSON("/Users/dsun/Google Drive/Takeout/Takeout 2/Chrome/BrowserHistory.json")
dt <- data.table(bhistory)
rm(bhistory)
```

## Format browser history
```{r}
url.regex = "^https?://([^/]+)/(.*)$"
dt[, date_time := as.POSIXct(time_usec/1000000, tz = "EST", origin = "1970-01-01")]
dt[, month := as.numeric(format(date_time, "%m"))]
dt[, year := as.numeric(format(date_time, "%Y"))]
dt[, host := gsub(url.regex, "\\1", url)]
```

## Line graph
### Prep data for line graph
We want a table with the top q most visited sites (determined by counting instances of the host name) for each year-month.
```{r}
library(zoo)
q = 5L
line.graph.data = dt[, .(count=.N), by = c("year","month","host")][order(year,month,-count)][, lapply(.SD, function(x) head(x, n=q)), by = c("year","month")]
line.graph.data[, month_year := as.yearmon(paste(month, year, sep="-"), "%m-%Y")]
setorder(line.graph.data, month_year)
head(line.graph.data)

```

### Produce line graph
Used [this website](http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/) as a reference for producing this graph.
```{r}
library(ggplot2)
ggplot(data=line.graph.data, aes(x=month_year, y=count, group=host, color=host, label=host)) +
    geom_line() +
    geom_point() +
    theme(legend.position="top")
```







